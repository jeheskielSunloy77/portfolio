---
import {
	DEFAULT_LANGUAGE,
	getPathnameWithoutLang,
	LANGUAGE_MAP,
	LANGUAGES,
	type Language,
} from '@/i18n/i18n'
import { APP_NAME, FULL_NAME } from '@/lib/constants'

export interface Props {
	title: string
	description: string
	canonical?: string
	ogImage?: string
	ogType?: 'website' | 'article'
	twitterCard?: 'summary' | 'summary_large_image'
	keywords?: string
	publishedTime?: Date
	modifiedTime?: Date
	author?: string
	articleSection?: string
	articleTags?: string[]
	twitterCreator?: string
	robots?: string
	lang: Language
}

const {
	title,
	description,
	canonical,
	ogImage = '/favicon.svg',
	ogType = 'website',
	twitterCard = 'summary_large_image',
	keywords = 'blog, portfolio, projects, tech, programming, development, web development, mobile development, software engineering',
	publishedTime,
	modifiedTime,
	author = FULL_NAME,
	articleSection,
	articleTags = [],
	twitterCreator,
	robots,
	lang,
} = Astro.props

const isRootEnglishAlias =
	Astro.url.pathname === '/' && lang === DEFAULT_LANGUAGE
const rootCanonicalURL = new URL(`/${DEFAULT_LANGUAGE}/`, Astro.site)
const canonicalURL =
	canonical ||
	(isRootEnglishAlias
		? rootCanonicalURL
		: new URL(Astro.url.pathname, Astro.site))
const fullOgImage = new URL(ogImage, Astro.site)
const robotsContent =
	robots || (isRootEnglishAlias ? 'noindex, follow' : 'index, follow')
const pathnameWithoutLang = getPathnameWithoutLang(Astro.url.pathname, lang)
const normalizedPath =
	pathnameWithoutLang === '/'
		? ''
		: pathnameWithoutLang.replace(/^\/+/, '').replace(/\/+$/, '')
const getLocalizedPath = (targetLang: Language) =>
	normalizedPath ? `/${targetLang}/${normalizedPath}/` : `/${targetLang}/`
---

<!-- Primary Meta Tags -->
<title>
	{title === FULL_NAME ? title : `${title} | ${FULL_NAME}`}
</title>
<meta name='title' content={title} />
<meta name='description' content={description} />
{keywords && <meta name='keywords' content={keywords} />}
<meta name='author' content={author} />
<meta name='robots' content={robotsContent} />
<meta name='language' content={LANGUAGE_MAP[lang].name} />
<meta name='revisit-after' content='7 days' />

<!-- Canonical URL -->
<link rel='canonical' href={canonicalURL} />
{
	LANGUAGES.map((targetLang) => (
		<link
			rel='alternate'
			hreflang={targetLang}
			href={new URL(getLocalizedPath(targetLang), Astro.site)}
		/>
	))
}
<link
	rel='alternate'
	hreflang='x-default'
	href={new URL(getLocalizedPath(DEFAULT_LANGUAGE), Astro.site)}
/>

<!-- Open Graph / Facebook -->
<meta property='og:type' content={ogType} />
<meta property='og:url' content={canonicalURL} />
<meta property='og:title' content={title} />
<meta property='og:description' content={description} />
<meta property='og:image' content={fullOgImage} />
<meta property='og:site_name' content={APP_NAME} />
{author && <meta property='og:article:author' content={author} />}
{
	publishedTime && (
		<meta
			property='og:article:published_time'
			content={publishedTime.toISOString()}
		/>
	)
}
{
	modifiedTime && (
		<meta
			property='og:article:modified_time'
			content={modifiedTime.toISOString()}
		/>
	)
}
{
	articleSection && (
		<meta property='og:article:section' content={articleSection} />
	)
}
{articleTags.map((tag) => <meta property='og:article:tag' content={tag} />)}

<!-- Twitter -->
<meta property='twitter:card' content={twitterCard} />
<meta property='twitter:url' content={canonicalURL} />
<meta property='twitter:title' content={title} />
<meta property='twitter:description' content={description} />
<meta property='twitter:image' content={fullOgImage} />
{twitterCreator && <meta name='twitter:creator' content={twitterCreator} />}

<!-- Favicon -->
<link rel='icon' type='image/svg+xml' href='/favicon.svg' />
<link rel='apple-touch-icon' href='/favicon.svg' />

<!-- Additional SEO optimizations -->
<meta name='theme-color' content='#000000' />
<meta name='msapplication-TileColor' content='#000000' />
